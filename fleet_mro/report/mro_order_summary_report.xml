<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_mro_order_summary_document">
        <t t-call="fleet_mro.fleet_mro_layout">
            <t t-set="doc" t-value="doc.with_context({'lang':doc.partner_id.lang})" />
            <div class="page">
                <div class="row">
                    <strong>Service Order: <span t-field="doc.name"/></strong>
                    <p t-if="doc.internal_repair">Internal Repair</p>
                </div>
                <table class="table table-condensed" style="page-break-inside: avoid">
                    <tr style="font-weight:bold;background-color: #f2f2f2">
                        <td width="25%" style="text-align:center;font-size: 10px">Date</td>
                        <td width="25%" style="text-align:center;font-size: 10px">Warehouse</td>
                        <td width="25%" style="text-align:center;font-size: 10px">Operating Unit</td>
                        <td width="25%" style="text-align:center;font-size: 10px">Supervisor</td>
                    </tr>
                    <tr>
                        <td style="text-align:center;font-size: 10px"><p t-field="doc.date"/></td>
                        <td style="text-align:center;font-size: 10px"><p t-field="doc.warehouse_id.name"/></td>
                        <td style="text-align:center;font-size: 10px"><p t-field="doc.operating_unit_id.name"/></td>
                        <td style="text-align:center;font-size: 10px"><p t-field="doc.supervisor_id.name"/></td>
                    </tr>
                    <tr style="font-weight:bold;background-color: #f2f2f2">
                        <td style="text-align:center;font-size: 10px">Vehicle</td>
                        <td style="text-align:center;font-size: 10px">Odometer</td>
                        <td style="text-align:center;font-size: 10px">Driver</td>
                        <td style="text-align:center;font-size: 10px">Service Type</td>
                    </tr>
                    <tr style="border-bottom: 1px solid #ddd;">
                        <td style="text-align:center;font-size: 10px"><p t-field="doc.vehicle_id.name"/></td>
                        <td style="text-align:center;font-size: 10px"><p t-field="doc.accumulated_odometer"/></td>
                        <td style="text-align:center;font-size: 10px"><p t-field="doc.driver_id.name"/></td>
                        <td style="text-align:center;font-size: 10px"><p t-field="doc.mro_type_id.name"/></td>
                    </tr>
                </table>



                <table class="table table-condensed">
                    <thead>
                        <tr style="font-weight:bold;background-color: #f2f2f2">
                            <th style="text-align:center;font-size: 8px">Task</th>
                            <th style="text-align:right;font-size: 8px" >Income</th>
                            <th style="text-align:right;font-size: 8px" >Spare Parts</th>
                            <th style="text-align:right;font-size: 8px" >WorkHand</th>
                            <th style="text-align:right;font-size: 8px" >Spare Parts Ext.</th>
                            <th style="text-align:right;font-size: 8px" >WorkHand Ext.</th>
                            <th style="text-align:right;font-size: 8px" >All Costs</th>
                            <th style="text-align:right;font-size: 8px" >Profit/Loss</th>
                        </tr>
                </thead>
                <tbody class="sale_tbody">
                        <t t-set="var_price_subtotal" t-value="0.0"/>
                        <t t-set="var_parts_cost" t-value="0.0"/>
                        <t t-set="var_cost_service" t-value="0.0"/>
                        <t t-set="var_parts_cost_external" t-value="0.0"/>
                        <t t-set="var_cost_service_external" t-value="0.0"/>
                        <t t-set="var_cost_all" t-value="0.0"/>
                        <t t-set="var_profit_loss" t-value="0.0"/>
                        
                        <t t-foreach="doc.task_ids" t-as="l">
                            <tr>
                                <td style="font-size: 8px"><span t-field="l.name"/></td>
                                <td style="text-align:right;font-size: 8px" ><span t-field="l.price_subtotal" /></td>
                                <td style="text-align:right;font-size: 8px" ><span t-field="l.parts_cost" /></td>
                                <td style="text-align:right;font-size: 8px" ><span t-field="l.cost_service" /></td>
                                <td style="text-align:right;font-size: 8px" ><span t-field="l.parts_cost_external" /></td>
                                <td style="text-align:right;font-size: 8px" ><span t-field="l.cost_service_external" /></td>
                                <td style="text-align:right;font-size: 8px" ><span t-field="l.cost_all" /></td>
                                <td style="text-align:right;font-size: 8px" ><span t-field="l.profit_loss" /></td>
                            </tr>
                            <t t-set="var_price_subtotal"   t-value="var_price_subtotal + l.price_subtotal"/>
                            <t t-set="var_parts_cost"       t-value="var_parts_cost + l.parts_cost"/>
                            <t t-set="var_cost_service"     t-value="var_cost_service + l.cost_service"/>
                            <t t-set="var_parts_cost_external" t-value="var_parts_cost_external + l.parts_cost_external"/>
                            <t t-set="var_cost_service_external" t-value="var_cost_service_external + l.cost_service_external"/>
                            <t t-set="var_cost_all"         t-value="var_cost_all + l.cost_all"/>
                            <t t-set="var_profit_loss"      t-value="var_profit_loss + l.profit_loss"/>
                        </t>
                    </tbody>
                    <tfoot class="sale_tbody">                    
                        <tr style="font-weight:bold;background-color: #f2f2f2">
                            <td style="text-align:right;font-size: 8px"><strong>Sum: </strong></td>
                            <td style="text-align:right;font-size: 8px"><t t-esc="'{0:,.2f}'.format(int(var_price_subtotal))" /></td>
                            <td style="text-align:right;font-size: 8px"><t t-esc="'{0:,.2f}'.format(int(var_parts_cost))" /></td>
                            <td style="text-align:right;font-size: 8px"><t t-esc="'{0:,.2f}'.format(int(var_cost_service))" /></td>
                            <td style="text-align:right;font-size: 8px"><t t-esc="'{0:,.2f}'.format(int(var_parts_cost_external))" /></td>
                            <td style="text-align:right;font-size: 8px"><t t-esc="'{0:,.2f}'.format(int(var_cost_service_external))" /></td>
                            <td style="text-align:right;font-size: 8px"><t t-esc="'{0:,.2f}'.format(int(var_cost_all))" /></td>
                            <td style="text-align:right;font-size: 8px"><t t-esc="'{0:,.2f}'.format(int(var_profit_loss))" /></td>
                        </tr>
                    </tfoot>
                </table>
                <p t-field="doc.note" />

                
            </div>
        </t>
    </template>


    <template id="report_mro_order_summary">
        <t t-set="data_report_margin_top" t-value="20"/> 
        <t t-set="data_report_header_spacing" t-value="10"/>
        <t t-set="data_report_dpi" t-value="600"/>    
        <t t-call="report.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-call="fleet_mro.report_mro_order_summary_document" t-lang="doc.partner_id.lang"/>
            </t>
        </t>
    </template>
</odoo>
